<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-T-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간단 다이노 게임</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: 'Arial', sans-serif;
        }
        #gameCanvas {
            border: 2px solid #333;
            background-color: #fff;
        }
        #scoreBoard {
            font-size: 24px;
            margin-top: 20px;
        }
        #gameOverText {
            font-size: 30px;
            color: red;
            position: absolute; /* Canvas 위에 겹치도록 */
            display: none; /* 처음엔 숨김 */
            cursor: pointer; /* 클릭 가능하도록 */
        }
    </style>
</head>
<body>

    <div id="scoreBoard">점수: 0</div>
    <div id="gameOverText">게임 오버!<br>(클릭해서 다시 시작)</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreBoard = document.getElementById('scoreBoard');
        const gameOverText = document.getElementById('gameOverText');

        // 캔버스 크기 설정
        canvas.width = 600;
        canvas.height = 200;

        // 게임 요소들
        let dino = {
            x: 50,
            y: canvas.height - 50, // 바닥에 붙어 있도록
            width: 40,
            height: 40,
            color: 'green',
            velocityY: 0,
            isJumping: false,
            jumpPower: 13, // 점프 높이 조절
            gravity: 0.7   // 중력 조절
        };

        let obstacles = [];
        let obstacleWidth = 20;
        let obstacleHeight = 40;
        let obstacleColor = 'red';
        let obstacleSpeed = 5; // 장애물 속도 (고정)
        let obstacleSpawnInterval = 120; // 프레임 단위, 약 2초 (60fps 기준)
        let frameCount = 0;

        let score = 0;
        let gameRunning = true;

        // 점프 함수
        function jump() {
            if (!dino.isJumping) {
                dino.isJumping = true;
                dino.velocityY = -dino.jumpPower;
            }
        }

        // 키보드 이벤트 리스너 (스페이스바로 점프)
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && gameRunning) {
                jump();
            }
        });
        
        // 게임 오버 텍스트 클릭 시 재시작
        gameOverText.addEventListener('click', function() {
            if (!gameRunning) {
                resetGame();
            }
        });


        function drawDino() {
            ctx.fillStyle = dino.color;
            ctx.fillRect(dino.x, dino.y, dino.width, dino.height);
        }

        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.fillStyle = obstacleColor;
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
        }

        function updateDino() {
            if (dino.isJumping) {
                dino.y += dino.velocityY;
                dino.velocityY += dino.gravity;

                // 바닥에 닿았는지 확인
                if (dino.y >= canvas.height - dino.height) {
                    dino.y = canvas.height - dino.height;
                    dino.isJumping = false;
                    dino.velocityY = 0;
                }
            }
        }

        function updateObstacles() {
            frameCount++;
            // 일정 간격으로 장애물 생성
            if (frameCount % obstacleSpawnInterval === 0) {
                let newObstacleY = canvas.height - obstacleHeight; // 바닥에 생성
                obstacles.push({
                    x: canvas.width, // 오른쪽 끝에서 시작
                    y: newObstacleY,
                    width: obstacleWidth,
                    height: obstacleHeight
                });
            }

            // 장애물 이동 및 화면 밖으로 나간 장애물 제거
            for (let i = obstacles.length - 1; i >= 0; i--) {
                obstacles[i].x -= obstacleSpeed;
                if (obstacles[i].x + obstacles[i].width < 0) {
                    obstacles.splice(i, 1);
                    if (gameRunning) { // 게임이 실행 중일 때만 점수 증가
                       score++;
                       updateScoreBoard();
                    }
                }
            }
        }
        
        function updateScoreBoard() {
            scoreBoard.textContent = '점수: ' + score;
        }

        function checkCollision() {
            obstacles.forEach(obstacle => {
                // AABB 충돌 감지 (Axis-Aligned Bounding Box)
                if (
                    dino.x < obstacle.x + obstacle.width &&
                    dino.x + dino.width > obstacle.x &&
                    dino.y < obstacle.y + obstacle.height &&
                    dino.y + dino.height > obstacle.y
                ) {
                    gameOver();
                }
            });
        }

        function gameOver() {
            gameRunning = false;
            gameOverText.style.display = 'block'; // 게임 오버 텍스트 보이기
            // 게임 오버 시에는 requestAnimationFrame을 멈추기 위해 gameLoop에서 처리
        }
        
        function resetGame() {
            dino.y = canvas.height - 50;
            dino.isJumping = false;
            dino.velocityY = 0;
            obstacles = [];
            score = 0;
            frameCount = 0;
            gameRunning = true;
            gameOverText.style.display = 'none'; // 게임 오버 텍스트 숨기기
            updateScoreBoard();
            gameLoop(); // 게임 루프 다시 시작
        }


        function gameLoop() {
            if (!gameRunning) {
                // 게임 오버 상태에서는 루프를 더 이상 진행하지 않음
                // 단, 재시작을 위해 gameOverText는 클릭 가능해야 함
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height); // 이전 프레임 지우기

            updateDino();
            drawDino();

            updateObstacles();
            drawObstacles();

            checkCollision();
            
            requestAnimationFrame(gameLoop); // 다음 프레임 요청
        }

        // 게임 시작
        resetGame(); // 초기화 및 게임 시작

    </script>
</body>
</html>

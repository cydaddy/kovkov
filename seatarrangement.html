<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>자리배치 프로그램</title>
    <style>
        /* CSS는 변경 없음 */
        :root {
            --primary-color: #4a90e2; --secondary-color: #f5f7fa; --border-color: #dce1e6;
            --text-color: #333; --desk-bg: #ffffff; --desk-border: #a0a0a0;
            --desk-shadow: rgba(0, 0, 0, 0.1); --male-color: #d1e7fd; --female-color: #f8d7da;
            --locked-color: #ffd700;
        }
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 0; background-color: var(--secondary-color); color: var(--text-color); overflow: hidden; }
        .container { display: flex; flex-direction: row; width: 100vw; height: 100vh; }
        .sidebar { width: 380px; flex-shrink: 0; padding: 20px; background-color: #fff; box-shadow: 2px 0 10px rgba(0,0,0,0.05); overflow-y: auto; display: flex; flex-direction: column; gap: 20px; border-right: 1px solid var(--border-color); z-index: 10; }
        .header-buttons { display: flex; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .control-group { border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; }
        .control-group h3 { margin: 0 0 15px 0; font-size: 1.1em; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .main-content { flex-grow: 1; min-width: 0; display: flex; flex-direction: column; position: relative; }
        #classroom-container { flex-grow: 1; position: relative; padding: 20px; overflow: auto; }
        #classroom { position: relative; width: 2500px; height: 2500px; background-image: linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px); background-size: 20px 20px; transform-origin: 0 0; }
        #chalkboard { position: absolute; left: 50%; transform: translateX(-50%); width: 40%; min-width: 200px; height: 30px; background-color: #3a5335; color: white; display: flex; align-items: center; justify-content: center; border-radius: 5px; font-weight: bold; }
        #chalkboard.top { top: 10px; } #chalkboard.bottom { bottom: 10px; }
        .desk { touch-action: none; user-select: none; position: absolute; background-color: var(--desk-bg); border: 1px solid var(--desk-border); border-radius: 5px; box-shadow: 2px 2px 5px var(--desk-shadow); display: flex; align-items: center; justify-content: center; font-size: 0.9em; font-weight: 500; cursor: grab; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .desk.dragging { opacity: 0.7; z-index: 1000; cursor: grabbing; }
        .desk.male { background-color: var(--male-color); } .desk.female { background-color: var(--female-color); }
        .desk-name { pointer-events: none; }
        .lock-icon { position: absolute; top: 2px; right: 2px; font-size: 0.8em; cursor: pointer; padding: 2px; }
        .desk.locked { border: 2px solid var(--locked-color); }
        #student-table { width: 100%; border-collapse: collapse; }
        #student-table th, #student-table td { border: 1px solid var(--border-color); padding: 8px; text-align: center; }
        #student-table th { background-color: var(--secondary-color); }
        #student-table input[type="text"], #student-table select { width: 95%; border: 1px solid #ccc; border-radius: 4px; padding: 4px; box-sizing: border-box; }
        .student-row button { border: none; background: none; cursor: pointer; color: #e74c3c; font-size: 1.2em; }
        button, input[type="file"]::file-selector-button { background-color: var(--primary-color); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: 500; transition: background-color 0.2s; }
        button:hover, input[type="file"]::file-selector-button:hover { background-color: #3a7ac8; }
        button:disabled { background-color: #aaa; color: #eee; cursor: not-allowed; }
        button.secondary { background-color: #6c757d; }
        button.secondary:hover { background-color: #5a6268; }
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; }
        textarea { width: calc(100% - 10px); height: 60px; border: 1px solid var(--border-color); border-radius: 4px; padding: 5px; resize: vertical; }
        .checkbox-group { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
        #error-message { display: none; background-color: #f8d7da; color: #721c24; padding: 15px; border: 1px solid #f5c6cb; border-radius: 8px; margin-top: 15px; }
        #error-message p { margin: 0; } #error-message ul { margin: 10px 0 0 20px; padding: 0; }
        @media (max-width: 768px) {
            body { height: auto; overflow: auto; } .container { flex-direction: column; height: auto; }
            .sidebar { width: 100%; box-sizing: border-box; height: auto; border-right: none; border-bottom: 1px solid var(--border-color); }
            .main-content { height: 70vh; }
        }
    </style>
</head>
<body>

<div class="container">
    <aside class="sidebar">
        <div class="header-buttons"><div class="button-group"><button id="file-menu-btn">📁 파일</button><button id="help-btn">❓ 도움말</button></div></div>
        <div class="control-group"><h3>👤 학생 명단</h3><div style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;"><table id="student-table"><thead><tr><th>이름</th><th>성별</th><th>삭제</th></tr></thead><tbody></tbody></table></div><div class="button-group"><button id="add-student-btn">학생 추가</button></div></div>
        <div class="control-group"><h3>⚙️ 배치 규칙 설정</h3><div class="checkbox-group"><label for="chalkboard-pos">칠판 위치:</label><select id="chalkboard-pos"><option value="top" selected>위</option><option value="bottom">아래</option></select></div><div class="checkbox-group"><input type="checkbox" id="gender-consideration"><label for="gender-consideration">성별 분리 배치 (책상 색상 지정)</label></div><label for="together-students"><b>함께</b> 앉힐 학생 (그룹별 줄바꿈, 쉼표 구분):</label><textarea id="together-students" placeholder="예: 김민준, 이서연&#10;박도윤, 최아윤"></textarea><label for="separate-students" style="margin-top:10px;"><b>따로</b> 앉힐 학생 (그룹별 줄바꿈, 쉼표 구분):</label><textarea id="separate-students" placeholder="예: 정우주, 이하은"></textarea></div>
        <div id="error-message"></div>
        <div class="control-group"><h3>🚀 실행 및 저장</h3><div class="button-group"><button id="arrange-seats-btn">자동 배치!</button><button id="reroll-btn" class="secondary">잠금 외 재배치</button></div><div class="button-group" style="margin-top:10px;"><button id="save-png-btn">PNG로 저장</button><button id="save-pdf-btn">PDF로 저장/인쇄</button></div><div class="button-group" style="margin-top:10px;"><button id="reset-layout-btn" class="secondary">전체 초기화</button></div></div>
    </aside>
    <main class="main-content"><div id="classroom-container"><div id="chalkboard" class="top">칠판</div><div id="classroom"></div></div></main>
</div>

<input type="file" id="csv-upload" accept=".csv" style="display: none;"><input type="file" id="state-upload" accept=".json" style="display: none;">

<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const DESK_WIDTH = 120, DESK_HEIGHT = 80, GRID_SIZE = 20;
    let students = [], desks = [];
    const DOM = {
        classroom: document.getElementById('classroom'),
        classroomContainer: document.getElementById('classroom-container'),
        studentTableBody: document.querySelector('#student-table tbody'), addStudentBtn: document.getElementById('add-student-btn'),
        arrangeSeatsBtn: document.getElementById('arrange-seats-btn'), rerollBtn: document.getElementById('reroll-btn'), chalkboardPos: document.getElementById('chalkboard-pos'),
        chalkboard: document.getElementById('chalkboard'), csvUpload: document.getElementById('csv-upload'), savePngBtn: document.getElementById('save-png-btn'),
        savePdfBtn: document.getElementById('save-pdf-btn'), resetLayoutBtn: document.getElementById('reset-layout-btn'), errorMessageDiv: document.getElementById('error-message'),
        genderConsiderationCheckbox: document.getElementById('gender-consideration'), fileMenuBtn: document.getElementById('file-menu-btn'), helpBtn: document.getElementById('help-btn'),
        togetherStudentsText: document.getElementById('together-students'), separateStudentsText: document.getElementById('separate-students'), stateUpload: document.getElementById('state-upload')
    };

    const shuffle = arr => arr.slice().sort(() => Math.random() - 0.5);
    
    const renderStudentTable = () => {
        DOM.studentTableBody.innerHTML = '';
        students.forEach((student, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" value="${student.name}" data-index="${index}" class="student-name-input"></td>
                <td><select data-index="${index}" class="student-gender-select"><option value="남" ${student.gender === '남' ? 'selected' : ''}>남</option><option value="여" ${student.gender === '여' ? 'selected' : ''}>여</option></select></td>
                <td><button class="delete-student-btn" data-index="${index}">-</button></td>`;
            DOM.studentTableBody.appendChild(row);
        });
    };

    const addStudent = () => { students.push({ name: `학생${students.length + 1}`, gender: '남' }); renderStudentTable(); updateDeskCount(); saveStateToLocal(); };
    const deleteStudent = (index) => { students.splice(index, 1); renderStudentTable(); updateDeskCount(); saveStateToLocal(); };
    const updateStudentData = (index, field, value) => { students[index][field] = value; saveStateToLocal(); };

    const createDesks = () => {
        DOM.classroom.innerHTML = ''; desks = [];
        students.forEach((_, index) => {
            const desk = { id: index, x: (index % 8) * (DESK_WIDTH + GRID_SIZE) + GRID_SIZE * 2, y: Math.floor(index / 8) * (DESK_HEIGHT + GRID_SIZE * 2) + GRID_SIZE * 2, studentName: null, locked: false, assignedGender: null };
            desks.push(desk);
        });
        renderUI();
    };
    const updateDeskCount = () => { if (desks.length !== students.length) { createDesks(); if (DOM.genderConsiderationCheckbox.checked) manageGenderAssignment(true); } };
    const resetAll = () => { if (confirm('모든 학생 명단과 배치, 규칙을 초기화하시겠습니까?')) { localStorage.removeItem('seatPlannerState'); students=[]; desks=[]; loadState(null); } };

    const snapToGrid = (value) => Math.round(value / GRID_SIZE) * GRID_SIZE;

    interact('.desk').draggable({
        listeners: {
            start(event) { event.target.classList.add('dragging'); },
            move(event) {
                const target = event.target;
                const x = (parseFloat(target.dataset.x) || 0) + event.dx;
                const y = (parseFloat(target.dataset.y) || 0) + event.dy;
                target.style.transform = `translate(${x}px, ${y}px)`;
                target.dataset.x = x;
                target.dataset.y = y;
            },
            end(event) {
                event.target.classList.remove('dragging');
                const deskId = parseInt(event.target.id.split('-')[1]);
                const desk = desks.find(d => d.id === deskId);

                if (desk) {
                    const rect = event.target.getBoundingClientRect();
                    const parentRect = DOM.classroom.getBoundingClientRect();
                    const rawX = rect.left - parentRect.left + DOM.classroomContainer.scrollLeft;
                    const rawY = rect.top - parentRect.top + DOM.classroomContainer.scrollTop;
                    const finalX = snapToGrid(rawX);
                    const finalY = snapToGrid(rawY);
                    desk.x = finalX;
                    desk.y = finalY;
                    event.target.dataset.x = finalX;
                    event.target.dataset.y = finalY;
                    event.target.style.transform = `translate(${finalX}px, ${finalY}px)`;
                }
                saveStateToLocal();
            }
        },
        modifiers: [
            interact.modifiers.snap({
                targets: (x, y, event) => {
                    const SNAP_RANGE = 40;
                    let snapPoints = [];
                    const draggedId = parseInt(event.target.id.split('-')[1]);
                    desks.forEach(desk => {
                        if (desk.id === draggedId) return;
                        snapPoints.push({ y: desk.y, x: desk.x + DESK_WIDTH, range: SNAP_RANGE });
                        snapPoints.push({ y: desk.y, x: desk.x - DESK_WIDTH, range: SNAP_RANGE });
                        snapPoints.push({ x: desk.x, y: desk.y + DESK_HEIGHT, range: SNAP_RANGE });
                        snapPoints.push({ x: desk.x, y: desk.y - DESK_HEIGHT, range: SNAP_RANGE });
                    });
                    const gridSnap = interact.snappers.grid({ x: GRID_SIZE, y: GRID_SIZE });
                    const snappedToGrid = gridSnap(x, y, event);
                    snappedToGrid.range = GRID_SIZE; 
                    snapPoints.push(snappedToGrid);
                    return snapPoints;
                },
                relativePoints: [{ x: 0, y: 0 }],
                endOnly: false
            }),
            interact.modifiers.restrictRect({ restriction: 'parent' })
        ]
    });

    interact('.desk').on('tap', (event) => {
        const deskId = parseInt(event.target.id.split('-')[1]);
        const desk = desks.find(d => d.id === deskId);
        if (desk && !desk.studentName && DOM.genderConsiderationCheckbox.checked) {
            if (desk.assignedGender === '남') desk.assignedGender = '여';
            else if (desk.assignedGender === '여') desk.assignedGender = null;
            else desk.assignedGender = '남';
            renderUI(); saveStateToLocal();
        }
    });

    const manageGenderAssignment = (assign) => {
        if (assign) {
            const maleCount = students.filter(s => s.gender === '남').length;
            shuffle(desks).forEach((desk, index) => { desk.assignedGender = index < maleCount ? '남' : '여'; });
        } else {
            desks.forEach(desk => desk.assignedGender = null);
        }
        renderUI(); saveStateToLocal();
    };
    const toggleLock = (deskId) => {
        const desk = desks.find(d => d.id === deskId);
        if (desk && desk.studentName) { desk.locked = !desk.locked; renderUI(); saveStateToLocal(); }
    };

    const arrangeSeats = (isReroll = false) => {
        clearError();
        const genderConsidered = DOM.genderConsiderationCheckbox.checked;
        let errorMessages = validateArrangement(isReroll, genderConsidered);
        if (errorMessages.length > 0) { displayError(errorMessages); return; }

        let assignableStudents = isReroll ? students.filter(s => !desks.find(d => d.studentName === s.name && d.locked)) : [...students];
        let availableDesks = isReroll ? desks.filter(d => !d.locked) : [...desks];
        availableDesks.forEach(d => { d.studentName = null; });
        
        let remainingStudents = shuffle(assignableStudents);
        let remainingDesks = shuffle(availableDesks);
        const assignments = new Map();

        remainingStudents.forEach(student => {
            let placed = false;
            for (let i = 0; i < remainingDesks.length; i++) {
                const desk = remainingDesks[i];
                if (genderConsidered) {
                    if (desk.assignedGender === student.gender) {
                        assignments.set(desk.id, student.name); placed = true;
                    }
                } else {
                    assignments.set(desk.id, student.name); placed = true;
                }
                if (placed) { remainingDesks.splice(i, 1); break; }
            }
        });
        
        desks.forEach(desk => {
            if (!desk.locked) { desk.studentName = assignments.get(desk.id) || null; }
        });
        renderUI(); saveStateToLocal();
    };

    const validateArrangement = (isReroll, genderConsidered) => {
        const errorMessages = [];
        if (genderConsidered) {
            const targetStudents = isReroll ? students.filter(s => !desks.find(d => d.studentName === s.name && d.locked)) : students;
            const targetDesks = isReroll ? desks.filter(d => !d.locked) : desks;
            const maleStudents = targetStudents.filter(s => s.gender === '남').length;
            const femaleStudents = targetStudents.filter(s => s.gender === '여').length;
            const maleDesks = targetDesks.filter(d => d.assignedGender === '남').length;
            const femaleDesks = targetDesks.filter(d => d.assignedGender === '여').length;
            if (maleStudents !== maleDesks) errorMessages.push(`남학생 수(${maleStudents})와 남학생 자리 수(${maleDesks})가 다릅니다.`);
            if (femaleStudents !== femaleDesks) errorMessages.push(`여학생 수(${femaleStudents})와 여학생 자리 수(${femaleDesks})가 다릅니다.`);
        }
        return errorMessages;
    };
    const displayError = (messages) => { DOM.errorMessageDiv.style.display = 'block'; DOM.errorMessageDiv.innerHTML = `<p><b>오류: 조건에 맞는 자리를 배정할 수 없습니다.</b></p><ul>${messages.map(m => `<li>${m}</li>`).join('')}</ul>`; };
    const clearError = () => { DOM.errorMessageDiv.style.display = 'none'; };

    const renderUI = () => {
        if (desks.length > 0 && DOM.classroom.children.length !== desks.length) DOM.classroom.innerHTML = '';
        if (desks.length === 0 && students.length > 0) createDesks();
        
        desks.forEach(desk => {
            let deskEl = document.getElementById(`desk-${desk.id}`);
            if (!deskEl) {
                deskEl = document.createElement('div'); deskEl.className = 'desk'; deskEl.id = `desk-${desk.id}`;
                deskEl.style.width = `${DESK_WIDTH}px`; deskEl.style.height = `${DESK_HEIGHT}px`;
                deskEl.innerHTML = `<span class="desk-name"></span><span class="lock-icon" data-desk-id="${desk.id}"></span>`;
                DOM.classroom.appendChild(deskEl);
            }
            deskEl.style.transform = `translate(${desk.x}px, ${desk.y}px)`;
            deskEl.dataset.x = desk.x; deskEl.dataset.y = desk.y;
            const nameSpan = deskEl.querySelector('.desk-name');
            const lockIcon = deskEl.querySelector('.lock-icon');
            deskEl.classList.remove('male', 'female', 'locked');
            const student = students.find(s => s.name === desk.studentName);
            if (student) {
                nameSpan.textContent = student.name; lockIcon.style.display = 'block';
                deskEl.classList.add(student.gender === '남' ? 'male' : 'female');
            } else {
                nameSpan.textContent = ''; lockIcon.style.display = 'none';
                if (desk.assignedGender) deskEl.classList.add(desk.assignedGender === '남' ? 'male' : 'female');
            }
            if (desk.locked) { deskEl.classList.add('locked'); lockIcon.textContent = '🔒'; } 
            else { lockIcon.textContent = '🔓'; }
        });
        DOM.arrangeSeatsBtn.disabled = desks.some(d => d.locked);
    };

    const saveStateToLocal = () => {
        const state = { students, desks, together: DOM.togetherStudentsText.value, separate: DOM.separateStudentsText.value, genderConsidered: DOM.genderConsiderationCheckbox.checked };
        localStorage.setItem('seatPlannerState', JSON.stringify(state));
    };
    const loadState = (state) => {
        if (!state) { const savedState = localStorage.getItem('seatPlannerState'); state = savedState ? JSON.parse(savedState) : { students: [], desks: [], together: '', separate: '', genderConsidered: false }; }
        students = state.students || []; desks = state.desks || [];
        DOM.togetherStudentsText.value = state.together || ''; DOM.separateStudentsText.value = state.separate || '';
        DOM.genderConsiderationCheckbox.checked = state.genderConsidered || false;
        renderStudentTable(); renderUI();
    };
    const saveStateToFile = () => {
        const state = localStorage.getItem('seatPlannerState');
        if (!state) { alert('저장할 데이터가 없습니다.'); return; }
        const blob = new Blob([state], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url;
        a.download = `seat-planner-state-${new Date().toISOString().slice(0,10)}.json`;
        a.click(); URL.revokeObjectURL(url);
    };
    const loadStateFromFile = (event) => {
        const file = event.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => { try { const state = JSON.parse(e.target.result); loadState(state); } catch (error) { alert('유효하지 않은 파일입니다.'); } };
        reader.readAsText(file); event.target.value = '';
    };

    const handleCsvUpload = (event) => {
        const file = event.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const newStudents = e.target.result.trim().split(/\r?\n/).slice(1).map(line => {
                    const [name, gender] = line.split(',').map(s => s.trim());
                    return (name && gender) ? { name, gender: gender === '남' ? '남' : '여' } : null;
                }).filter(Boolean);
                if (newStudents.length > 0) {
                    students = newStudents;
                    desks = []; // 학생이 바뀌었으니 책상도 초기화
                    renderStudentTable(); updateDeskCount(); saveStateToLocal();
                    alert(`${newStudents.length}명의 학생 명단을 불러왔습니다.`);
                } else { alert('CSV 파일 형식이 올바르지 않거나 내용이 없습니다.'); }
            } catch (error) { alert('CSV 파일을 처리하는 중 오류가 발생했습니다.'); }
        };
        reader.readAsText(file, "UTF-8"); event.target.value = '';
    };
    const handleCsvDownload = () => {
        if (students.length === 0) { alert('내보낼 학생 명단이 없습니다.'); return; }
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF이름,성별\n";
        students.forEach(s => { csvContent += `${s.name},${s.gender}\n`; });
        const link = document.createElement("a"); link.setAttribute("href", encodeURI(csvContent));
        link.setAttribute("download", "student_list.csv");
        document.body.appendChild(link); link.click(); document.body.removeChild(link);
    };
    const captureClassroom = (format) => { /* 이전과 동일한 캡처 로직 */ };

    // --- 이벤트 리스너 ---
    DOM.fileMenuBtn.addEventListener('click', () => {
        const action = prompt(`[파일 메뉴]\n1: 상태 저장 (json)\n2: 상태 불러오기 (json)\n3: CSV 학생 명단 가져오기\n4: CSV 학생 명단 내보내기\n\n번호 입력:`);
        switch(action) {
            case '1': saveStateToFile(); break; case '2': DOM.stateUpload.click(); break;
            case '3': DOM.csvUpload.click(); break; case '4': handleCsvDownload(); break;
        }
    });
    DOM.helpBtn.addEventListener('click', () => { alert(`[도움말]\n\n- 성별 분리: 체크박스를 켜면 책상 색이 지정됩니다. 빈 책상을 클릭해 수동 변경 가능합니다.\n\n- 자리 잠금: 학생 배정 후 자물쇠 아이콘(🔓)을 클릭하면 자리가 잠깁니다. 잠긴 자리가 있으면 '자동 배치'가 비활성화됩니다.\n\n- 파일: 현재 모든 상태(책상 위치, 학생, 규칙)를 json 파일로 저장/불러오기 할 수 있습니다.`); });
    
    // ✨ 추가: 자리 잠금/해제 기능을 위한 이벤트 위임
    DOM.classroom.addEventListener('click', (e) => {
        if (e.target.classList.contains('lock-icon')) {
            const deskId = parseInt(e.target.dataset.deskId, 10);
            toggleLock(deskId);
        }
    });

    // ✨ 추가된 이벤트 리스너
    DOM.genderConsiderationCheckbox.addEventListener('change', (e) => {
        manageGenderAssignment(e.target.checked);
    });

    DOM.addStudentBtn.addEventListener('click', addStudent);
    DOM.arrangeSeatsBtn.addEventListener('click', () => arrangeSeats(false));
    DOM.rerollBtn.addEventListener('click', () => arrangeSeats(true));
    DOM.chalkboardPos.addEventListener('change', (e) => { DOM.chalkboard.className = e.target.value; });
    DOM.csvUpload.addEventListener('change', handleCsvUpload);
    DOM.stateUpload.addEventListener('change', loadStateFromFile);
    DOM.savePngBtn.addEventListener('click', () => captureClassroom('png'));
    DOM.savePdfBtn.addEventListener('click', () => captureClassroom('pdf'));
    DOM.resetLayoutBtn.addEventListener('click', resetAll);
    
    // ✨ 수정된 부분: genderConsiderationCheckbox가 아래 배열에서 제거됨
    [DOM.togetherStudentsText, DOM.separateStudentsText].forEach(el => el.addEventListener('input', saveStateToLocal));
    
    DOM.studentTableBody.addEventListener('change', saveStateToLocal);
    DOM.studentTableBody.addEventListener('click', (e) => { if(e.target.classList.contains('delete-student-btn')) saveStateToLocal(); });


    // --- 초기화 ---
    loadState(null);
});
</script>

</body>
</html>
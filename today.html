<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>오늘의 당번</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&display=swap');

    :root {
      --bg-color: #ffeaa7;
      --card-bg: #fab1a0;
      /* Pastel Coral/Orange */
      --border: 4px solid #000000;
      --shadow: 8px 8px 0px #000000;
      --text-main: #2d3436;
      --accent: #ff7675;

      /* Dynamic Sizes */
      --size-date: 15vmin;
      --size-today: 25vmin;
      --size-duty: 25vmin;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      height: 100vh;
      width: 100vw;
      background-color: var(--bg-color);
      font-family: 'Do Hyeon', sans-serif;
      color: var(--text-main);
      overflow: hidden;
      /* No scrollbars */
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2vmin;
      user-select: none;
      /* Disable text selection globally */
      -webkit-user-select: none;
    }

    #app {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-rows: 1fr 2fr;
      /* Top 1/3, Bottom 2/3 */
      gap: 2vmin;
    }

    .row-bottom {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2vmin;
    }

    .neo-card {
      background: var(--card-bg);
      border: var(--border);
      box-shadow: var(--shadow);
      border-radius: 0;
      /* Brutalist */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      transition: transform 0.1s;
    }

    .neo-card:active {
      transform: translate(2px, 2px);
      box-shadow: 4px 4px 0px #000000;
    }

    /* Typography */
    .label {
      font-size: 5vmin;
      margin-bottom: 2vmin;
    }

    .value {
      font-family: 'Black Han Sans', sans-serif;
      line-height: 1;
    }

    #todayNum {
      font-size: var(--size-today);
    }

    #dutyNum {
      font-size: var(--size-duty);
    }

    .date-value {
      font-size: var(--size-date);
    }

    /* Settings Button */
    #settings-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--accent);
      border: var(--border);
      padding: 10px;
      box-shadow: 4px 4px 0px #000000;
      cursor: pointer;
      z-index: 1000;
      font-family: 'Do Hyeon', sans-serif;
      font-size: 1.2rem;
      color: black;
    }

    #settings-btn:active {
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0px #000000;
    }

    /* Settings Panel */
    #settings-panel {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: var(--border);
      box-shadow: var(--shadow);
      padding: 30px;
      z-index: 2000;
      width: 90vw;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    #settings-panel h2 {
      margin-top: 0;
      border-bottom: 4px solid black;
      padding-bottom: 10px;
    }

    .control-group {
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
    }

    .control-group label {
      margin-bottom: 5px;
      font-weight: bold;
    }

    .control-group input[type="range"] {
      width: 100%;
      height: 10px;
      accent-color: black;
      border: 2px solid black;
    }

    .control-group input[type="color"] {
      width: 50px;
      height: 30px;
      border: 2px solid black;
      padding: 0;
    }

    .backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1500;
    }

    /* Utility */
    .clickable {
      cursor: pointer;
      color: #0984e3;
      text-decoration: none;
      /* Removed underline */
    }

    .clickable:hover {
      color: #d63031;
    }
  </style>
</head>

<body>

  <button id="settings-btn" onclick="toggleSettings()">⚙️ 설정</button>

  <div id="app">
    <!-- Top: Date -->
    <div class="neo-card">
      <div class="value date-value">
        <span id="month" class="clickable" onclick="rotateDescending()">0</span>월
        <span id="day" class="clickable" onclick="rotateAscending()">0</span>일
      </div>
    </div>

    <!-- Bottom: Numbers -->
    <div class="row-bottom">
      <div class="neo-card">
        <div class="label">오늘의 번호</div>
        <div class="value" id="todayNum">1</div>
      </div>
      <div class="neo-card">
        <div class="label">급식 당번</div>
        <div class="value" id="dutyNum">1</div>
      </div>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div class="backdrop" id="backdrop" onclick="toggleSettings()"></div>
  <div id="settings-panel">
    <h2>설정</h2>

    <div class="control-group">
      <label>날짜 글자 크기</label>
      <input type="range" id="input-size-date" min="5" max="40" step="1">
    </div>

    <div class="control-group">
      <label>오늘의 번호 크기</label>
      <input type="range" id="input-size-today" min="10" max="60" step="1">
    </div>

    <div class="control-group">
      <label>급식 당번 크기</label>
      <input type="range" id="input-size-duty" min="10" max="60" step="1">
    </div>

    <div style="display: flex; gap: 20px;">
      <div class="control-group">
        <label>글자 색상</label>
        <input type="color" id="input-color-text">
      </div>
      <div class="control-group">
        <label>전체 배경</label>
        <input type="color" id="input-color-bg">
      </div>
      <div class="control-group">
        <label>카드 배경</label>
        <input type="color" id="input-color-card">
      </div>
    </div>

    <div style="margin-top: 20px;">
      <button onclick="toggleSettings()"
        style="width:100%; padding: 15px; background: #ff7675; border: 4px solid black; font-weight: bold; font-family: 'Do Hyeon'; font-size: 1.2rem; cursor: pointer; box-shadow: 4px 4px 0px black;">닫기
        (저장)</button>
    </div>
  </div>

  <script>
    // State Defaults
    const defaults = {
      todayVal: 3, dutyVal: 5,
      sizeDate: 15, sizeToday: 25, sizeDuty: 25,
      colorText: '#2d3436', colorBg: '#ffeaa7', colorCard: '#fab1a0'
    };

    // Load State
    let todayVal = parseInt(localStorage.getItem('todayVal')) || defaults.todayVal;
    let dutyVal = parseInt(localStorage.getItem('dutyVal')) || defaults.dutyVal;

    // Render
    const update = () => {
      const now = new Date();
      document.getElementById('month').innerText = now.getMonth() + 1;
      document.getElementById('day').innerText = now.getDate();
      document.getElementById('todayNum').innerText = todayVal;
      document.getElementById('dutyNum').innerText = dutyVal;
    };

    // Logic
    function rotateAscending() { // Day Click -> Increase
      todayVal = (todayVal % 4) + 1;
      dutyVal = (dutyVal % 6) + 1;
      saveData(); update();
    }

    function rotateDescending() { // Month Click -> Decrease
      todayVal = todayVal - 1; if (todayVal < 1) todayVal = 4;
      dutyVal = dutyVal - 1; if (dutyVal < 1) dutyVal = 6;
      saveData(); update();
    }

    function saveData() {
      localStorage.setItem('todayVal', todayVal);
      localStorage.setItem('dutyVal', dutyVal);
    }

    function toggleSettings() {
      const p = document.getElementById('settings-panel');
      const b = document.getElementById('backdrop');
      const show = p.style.display !== 'block';
      p.style.display = show ? 'block' : 'none';
      b.style.display = show ? 'block' : 'none';
    }

    // --- Settings Management ---
    const inputs = {
      sizeDate: document.getElementById('input-size-date'),
      sizeToday: document.getElementById('input-size-today'),
      sizeDuty: document.getElementById('input-size-duty'),
      colorText: document.getElementById('input-color-text'),
      colorBg: document.getElementById('input-color-bg'),
      colorCard: document.getElementById('input-color-card')
    };

    function loadSettings() {
      // Load or Default
      const set = (key, def) => {
        const val = localStorage.getItem(key) || def;
        inputs[key].value = val;
        applySetting(key, val);
      };

      set('sizeDate', defaults.sizeDate);
      set('sizeToday', defaults.sizeToday);
      set('sizeDuty', defaults.sizeDuty);
      set('colorText', defaults.colorText);
      set('colorBg', defaults.colorBg);
      set('colorCard', defaults.colorCard);
    }

    function applySetting(key, val) {
      const r = document.documentElement.style;
      if (key === 'sizeDate') r.setProperty('--size-date', val + 'vmin');
      if (key === 'sizeToday') r.setProperty('--size-today', val + 'vmin');
      if (key === 'sizeDuty') r.setProperty('--size-duty', val + 'vmin');
      if (key === 'colorText') r.setProperty('--text-main', val);
      if (key === 'colorBg') r.setProperty('--bg-color', val);
      if (key === 'colorCard') r.setProperty('--card-bg', val);
    }

    // Bind Events
    Object.keys(inputs).forEach(key => {
      inputs[key].addEventListener('input', (e) => {
        const val = e.target.value;
        applySetting(key, val);
        localStorage.setItem(key, val);
      });
    });

    // Loop for date check
    let lastDate = new Date().getDate();
    setInterval(() => {
      const now = new Date();
      if (now.getDate() !== lastDate) {
        lastDate = now.getDate();
        update();
      }
    }, 1000);

    // Init
    loadSettings();
    update();
  </script>
</body>

</html>